name: Add Labels for Comments

on:
  push:
    branches: [ main ]
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  pull_request:
    branches: [ main ]
    types: [assigned, opened, synchronize, reopened, labeled, unlabeled]

jobs:
  dump-stuff:
    runs-on: ubuntu-latest
    steps:
    - run: printenv
    - run: echo {{ github.event }}

  add-label-missing-comment:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Add comment about missing build-dependency-containers label
      uses: actions/github-script@v4
      if: success()
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
          github.issues.createComment({
            issue_number: context.payload.pull_request.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'Hi there, this change should run a build dependency containers, but running it will take hours. Do you want to run it? If so, please add flag build-dependency-containers by commenting "/add-build-dependency-containers".'
          })

  add-build-label-to-pr:
    runs-on: ubuntu-latest
    if: contains(github.event.comment.body, '/add-build-dependency-containers') && github.event_name == 'pull_request_review_comment'
    steps:
    - uses: actions/checkout@v2
    - name: Add label
      uses: actions/github-script@v4
      if: success()
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
          github.issues.addLabels({
            issue_number: context.payload.pull_request.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['build-dependency-containers']
          })
          github.issues.createComment({
            issue_number: context.payload.pull_request.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'ðŸ‘‹ Added build-dependency-containers label :)!'
          })

  add-labels-issue:
    runs-on: ubuntu-latest
    if: contains(github.event.comment.body, '/add-invalid') && github.event_name == 'issue_comment'
    steps:
    - uses: actions/checkout@v2
    - name: Add label test
      uses: actions/github-script@0.9.0
      if: success()
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
          github.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['invalid']
          })
          github.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'ðŸ‘‹ Added invalid :)!'
          })

  add-labels-pr:
    runs-on: ubuntu-latest
    if: contains(github.event.comment.body, '/add-invalid') && github.event_name == 'pull_request_review_comment'
    steps:
    - uses: actions/checkout@v2
    - name: Add label
      uses: actions/github-script@0.9.0
      if: success()
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
          github.issues.addLabels({
            issue_number: context.payload.pull_request.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['invalid']
          })
          github.issues.createComment({
            issue_number: context.payload.pull_request.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'ðŸ‘‹ Added invalid :)!'
          })
